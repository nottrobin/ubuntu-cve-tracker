" Vim syntax file
" Language: UCT CVEs
" Maintainer: Jamie Strandboge
" Latest Revision: 05 October 2012
"
" To use:
" $ mkdir -p ~/.vim/syntax
" $ ln -s $UCT/scripts/cve.vim ~/.vim/syntax/cve.vim
" Add to ~/.vimrc:
" autocmd BufNewFile,BufRead CVE-[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] set syntax=cve
" autocmd BufNewFile,BufRead 00boilerplate.* set syntax=cve
"
" TODO:
" - turn the release names into variables so we only have to update in one
"   place
" - maybe do something with URLs
"

if version < 600
  syntax clear
elseif exists("b:current_syntax")
  finish
endif

" Should match case except for the keys of each field
syn case match

" Everything that is not explicitly matched by the rules below
syn match cveElse "^.*$"

syn match cveRelease "\(devel\|upstream\|warty\|hoary\|breezy\|dapper\|edgy\|feisty\|gutsy\|hardy\|intrepid\|jaunty\|karmic\|lucid\|maverick\|natty\|oneiric\|precise\|quantal\)"
syn match cveSrcPkg contained "[a-z0-9][a-z0-9+.-]\+"
syn match cveId contained "CVE-[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]"
syn match cveDate contained  "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\( [0-2][0-9]:[0-5][0-9]:[0-5][0-9] [A-Z][A-Z][A-Z]\)\?"
syn match cveStatus contained "\(needs\-triage\|needed\|deferred\|pending\|released\|ignored\|not\-affected\|DNE\)"
syn match cveStatusExtra contained " (.\+)"

" Standard keys
syn match cveKey "^\%(Candidate\|PublicDate\|PublicDateAtUSN\|CRD\|References\|Description\|Ubuntu-Description\|Notes\|Bugs\|Discovered-by\|Assigned-to\|Patches_[a-z0-9][a-z0-9+.-]\+\): *"

" Release/status key
" <release>_<srcpkg>: <status>
syn match cveKeyRelease "^\%(devel\|upstream\|warty\|hoary\|breezy\|dapper\|edgy\|feisty\|gutsy\|hardy\|intrepid\|jaunty\|karmic\|lucid\|maverick\|natty\|oneiric\|precise\|quantal\)_[a-z0-9][a-z0-9+.-]\+: *"

" Priorities key
" Priority[_<srcpkg>[_<release>]]: <priority>
syn match cvePriorityValue contained "\(negligible\|low\|medium\|high\|critical\)"
syn match cvePriorityKey "^Priority\(_[a-z0-9][a-z0-9+.-]\+\(_\(devel\|upstream\|warty\|hoary\|breezy\|dapper\|edgy\|feisty\|gutsy\|hardy\|intrepid\|jaunty\|karmic\|lucid\|maverick\|natty\|oneiric\|precise\|quantal\)\)\?\)\?: *"

" Tags key
" Tags_<srcpkg>[_<release>]: <tag>
syn match cveTagValue contained "\(apparmor\|fortify-source\|hardlink-restriction\|heap-protector\|not-ue\|pie\|stack-protector\|symlink-restriction\|universe-binary\)"
syn match cveTagKey "^Tags_[a-z0-9][a-z0-9+.-]\+\(_\(devel\|upstream\|warty\|hoary\|breezy\|dapper\|edgy\|feisty\|gutsy\|hardy\|intrepid\|jaunty\|karmic\|lucid\|maverick\|natty\|oneiric\|precise\|quantal\)\)\?: *"

" Fields where we do strict syntax checking
syn region cveStrictField start="^Priority" end="$" contains=cvePriorityKey,cvePriorityValue oneline
syn region cveStrictField start="^Tags" end="$" contains=cveTagKey,cveTagValue oneline
syn region cveStrictField start="^Candidate" end="$" contains=cveKey,cveId
syn region cveStrictField start="^\(PublicDate\|CRD\)" end="$" contains=cveKey,cveDate
syn region cveStrictField start="^Patches_" end=":$" contains=cveKey,cveSrcPkg oneline
syn region cveStrictField start="^[a-z]\+_" end="$" contains=cveKeyRelease,cveStatus,cveStatusExtra oneline

if version >= 508 || !exists("did_cve_syn_inits")
  command -nargs=+ HiLink hi def link <args>

  HiLink cveKey                 Keyword
  HiLink cvePriorityKey         Keyword
  HiLink cveTagKey              Keyword
  HiLink cveKeyRelease          Keyword
  HiLink cveElse                Normal
  HiLink cveStrictField         Error

  delcommand HiLink
endif

let b:current_syntax = "cve"
" vim: ts=8 sw=2
